$(function(){var c=new jStrap();c.maxLenghtDoc("#tipodoc");var a={validaDni:{bad:"Ingrese el número de Documento",good:""},validaCupon:{bad:"Ingrese el número de Cupón",good:""},validaError:{error1:"No puede Generar Cupón para este suscriptor",error2:"El suscriptor esta inactivo",error3:"Stock de Descuentos Agotados",success:"Registro de cupón exitoso"}};
var b={validarDNI:function(d){$(d).bind("click",function(j){j.preventDefault();var q=$(this);var n="",f="",p="",h="",g="";var o=$("#adminEstaContentBox");
o.removeClass("hide");var m=$("#fNDoc");var i=$("#tipodoc").val();f=a.validaDni.bad;p=m.val();n="0";var l=$("#errorValidarDni");var k=$("#errorValidarCupon");
k.slideUp("fast",function(){k.addClass("hide");});if($.trim(p)!=""){l.slideUp("fast",function(){l.addClass("hide");});o.addClass("loading");o.html("");
$.ajax({url:"/establecimiento/redencion-beneficio/valida-dni-cupon",type:"POST",dataType:"html",data:{tipo:n,value:p,col:h,ord:g,tipodoc:i},success:function(e){o.removeClass("loading");
o.html(e);$(d).unbind();$(".AdEsRedimirBtn").unbind();$("a.Btnredimir").unbind();b.validarDNI(d);b.detalleRedimirCupon(".AdEsRedimirBtn");},error:function(e){}});
}else{l.html(f);l.slideDown("fast",function(){l.removeClass("hide");});}});},validarCupon:function(d){$(d).bind("click",function(i){i.preventDefault();
var p=$(this);var l,f,o,h,g,m="";var n=$("#adminEstaContentBox");n.removeClass("hide");m=$("#fNCupon");f=a.validaCupon.bad;o=m.val();l="1";var k=$("#errorValidarCupon");
var j=$("#errorValidarDni");j.slideUp("fast",function(){j.addClass("hide");});if($.trim(o)!=""){k.slideUp("fast",function(){k.addClass("hide");});n.addClass("loading");
n.html("");$.ajax({url:"/establecimiento/redencion-beneficio/valida-dni-cupon",type:"POST",dataType:"html",data:{tipo:l,value:o,col:h,ord:g},success:function(e){n.removeClass("loading");
n.html(e);$(d).unbind();$(".AdEsRedimirBtn").unbind();$("a.Btnredimir").unbind();b.validarCupon(d);b.detalleRedimirCupon(".AdEsRedimirBtn");},error:function(e){}});
}else{k.html(f);k.slideDown("fast",function(){k.removeClass("hide");});}});},detalleRedimirCupon:function(d){$(d).bind("click",function(k){k.preventDefault();
var m=$(this);var i=m.attr("idS");var g=m.attr("idB");var h=m.attr("est");var j=m.attr("nroC");var l=$("#mictBenContent").attr("tipo");var n=$("#content-winRedimirCupon");
var f=$("#csrf").text();n.html("");n.addClass("loading");$.ajax({type:"GET",url:"/establecimiento/redencion-beneficio/redimir-cupon/",data:{idS:i,idB:g,est:h,nroC:j,tipo:l,csrf:f},dataType:"html",success:function(e){n.removeClass("loading");
if($(e).attr("data-error")=="1"||$(e).attr("data-error")=="0"){n.html(e);}if($(e).attr("data-error")=="-2"){n.html('<div class="bad">'+a.validaError.error1+"</div>");
b.closeWindow();}if($(e).attr("data-error")=="-3"){n.html('<div class="bad">'+a.validaError.error2+"</div>");b.closeWindow();}if($(e).attr("data-error")=="-4"){n.html('<div class="bad">'+a.validaError.error3+"</div>");
b.closeWindow();}b.redimirCupon(".Btnredimir");c.onlyNum("#fMonto");}});});},redimirCupon:function(d){$(d).bind("click",function(n){n.preventDefault();
var q=$(this);var k=q.attr("idS");var g=q.attr("idB");var h=q.attr("est");var m=q.attr("nroC");var o=$("#fMonto").val();var i=$("#fBoucher").val();var p=q.attr("tipo");
var f=$("#csrf"),l=$("#csrf2");f.val(l.html());var r=$("#content-winRedimirCupon"),j=$("#frmRedimirCupon").serialize();r.html("");r.addClass("loading");
$.ajax({type:"POST",url:"/establecimiento/redencion-beneficio/redimir-cupon/",data:j+"&idS="+k+"&idB="+g+"&est="+h+"&nroC="+m+"&monto="+o+"&numero_cupon="+i+"&tipo="+p+"&csrf="+f.val(),dataType:"html",success:function(e){r.removeClass("loading");
if($(e).attr("data-error")=="-1"){r.html(e);}if($(e).attr("data-error")=="1"){r.html('<div class="good">'+a.validaError.success+"</div>");$("#adminEstaContentBox").html("");
b.closeWindow();}b.redimirCupon(".Btnredimir");c.onlyNum("#fMonto");}});});},reloadDetalle:function(){var e=$("#mictBenContent");var i=e.attr("idbene");
var h=e.attr("tipo");var d=e.attr("tipodoc");var g="";var f="";var j=$("#adminEstaContentBox");j.html("");j.addClass("loading");$.ajax({url:"/establecimiento/redencion-beneficio/valida-dni-cupon",type:"POST",dataType:"html",data:{tipo:h,value:i,col:g,ord:f,tipodoc:d},success:function(k){j.removeClass("loading");
j.html(k);if(h==0){$("#addValidateDni").unbind();$(".AdEsRedimirBtn").unbind();$("a.Btnredimir").unbind();b.validarDNI("#addValidateDni");b.detalleRedimirCupon(".AdEsRedimirBtn");
}else{$("#addValidateCupon").unbind();$(".AdEsRedimirBtn").unbind();$("a.Btnredimir").unbind();b.validarCupon("#addValidateCupon");b.detalleRedimirCupon(".AdEsRedimirBtn");
}},error:function(k){}});},closeWindow:function(){setTimeout(function(){$("#winRedimirCupon .closeWM").click();},1500);},paginado:function(){$(".itemPag a[href]").live("click",function(j){j.preventDefault();
var h=$(this).attr("rel");var m=$("#adminEstaContentBox");var k=$("#mictBenContent");var d=k.attr("ord");var f=k.attr("col");var i=k.attr("idbene");var l=k.attr("tipo");
var g=k.attr("tipodoc");m.addClass("loading");m.html("");(h==undefined)?(h=""):(h=h);(m==undefined)?(m=""):(m=m);(d==undefined)?(d=""):(d=d);(f==undefined)?(f=""):(f=f);
(i==undefined)?(i=""):(i=i);(l==undefined)?(l=""):(l=l);var n={page:h,ord:d,col:f,value:i,tipo:l,tipodoc:g};$.ajax({data:n,url:"/establecimiento/redencion-beneficio/valida-dni-cupon",type:"POST",dataType:"html",success:function(e){m.html(e);
m.removeClass("loading");var o="#addValidateDni";$(o).unbind();$(".AdEsRedimirBtn").unbind();$("a.Btnredimir").unbind();b.validarDNI(o);b.detalleRedimirCupon(".AdEsRedimirBtn");
}});});},ordenamiento:function(){$(".ordenarFecha").live("click",function(j){j.preventDefault();var m=$("#adminEstaContentBox");var k=$("#mictBenContent");
var d=k.attr("ord");var f=k.attr("col");var i=k.attr("idbene");var l=k.attr("tipo");var h=k.attr("page");var g=k.attr("tipodoc");m.addClass("loading");
m.html("");(h==undefined)?(h=""):(h=h);(m==undefined)?(m=""):(m=m);(d==undefined)?(d=""):(d=d);(f==undefined)?(f=""):(f=f);(i==undefined)?(i=""):(i=i);
(l==undefined)?(l=""):(l=l);if(d==""||d=="DESC"){d="ASC";}else{d="DESC";}var n={page:h,ord:d,col:f,value:i,tipo:l,tipodoc:g};$.ajax({data:n,url:"/establecimiento/redencion-beneficio/valida-dni-cupon",type:"POST",dataType:"html",success:function(e){m.html(e);
m.removeClass("loading");var o="#addValidateDni";$(o).unbind();$(".AdEsRedimirBtn").unbind();$("a.Btnredimir").unbind();b.validarDNI(o);b.detalleRedimirCupon(".AdEsRedimirBtn");
}});});},maxLenghtN:function(f){var d=$(f),e=d.next();d.bind("change",function(){var i=$(this),g=(i.val()).split("#"),j=g[1],h=e.val();e.removeAttr("maxlength").attr("maxlength",j);
e.val(h);e.focus();});e.bind("keyup click blur focus change paste",function(l){var j=$(this),h=(j.siblings("select").val()).split("#"),m=parseInt(h[1]),g;
var i=l.which;var k=j.val().length;if(k>m){g=j.val().substring(m,"");e.val(g);}});},redencionLote:function(e){var f=$(e),g=$("#aAddMoreCupons");g.live("click",function(){d();
});f.live("keyup",function(i){i.preventDefault();var h=i.keyCode||i.charCode||i.which||window.e;if(h===13){d();}});function d(){var i=$("#idAjaxRedimirLote"),h=$("#frmRedimirCupon").serialize();
i.html("");i.addClass("loading center mB10");$.ajax({data:h,url:"/establecimiento/redencion-beneficio/redimir-lote",type:"POST",dataType:"html",success:function(j){i.html(j);
i.removeClass("loading");}});}f.live("keypress",function(i){var h=i.keyCode||i.charCode||i.which||window.e;if(h==8){return true;}if(h==0){return true;}if(h==13){return true;
}if(h==39||h==37){return true;}if(h==9){return true;}var k=/\d/,j=String.fromCharCode(h);return k.test(j);});},validaMntoDcto:function(d){var f=$(d),e=0;
f.live("keypress",function(j){var g=false;var i=j.keyCode||j.charCode||j.which||window.e;var h=$(this).val();if((i>=48&&i<=57)||(i==46)||(i==8)||(i==9)||(i==39)||(i==37)){g=true;
if(i==46){e++;if(e>1&&h.indexOf(".")>=0){g=false;}if(h.length==0){g=false;}}}return g;});},showMessageCbo:function(d){var e=$(d);e.live("change",function(){var h=$(this),f=h.val(),g=(f==""?"Seleccione Descuento":messageTipB[f]);
h.next().find("span").html(g);});}};b.validarDNI("#addValidateDni");b.validarCupon("#addValidateCupon");b.detalleRedimirCupon(".AdEsRedimirBtn");b.redimirCupon(".Btnredimir");
b.paginado();b.ordenamiento();b.maxLenghtN("#tipodoc");b.redencionLote("#nrocupones");b.validaMntoDcto(".txtMntoDescR");b.showMessageCbo(".cboMntoDescR");
$(this).ajaxError(function(f,e,g,d){if(e.status==401){window.location.href="/establecimiento/error/"+e.status;}});});