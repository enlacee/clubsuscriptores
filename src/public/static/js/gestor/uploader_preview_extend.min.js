$(function(){var l="#txtImage";var f="#preloader";var j=".admiGeCrossLittle";var d="#admi-edit";var c="#admi-star";var g="#FirstImagen";var h="#SecondImagen";
var e=0;var k=0;var i=new Array();var b=new Array();jq.pasteMaxlength("#contenido");var a={carga:function(){var m=$("#contentImgs").find("li");if(m.size()>0){k=1;
}else{k=0;}$.each(m,function(n,p){var o=$(p).find("img").attr("valor");i.push(o);});$.each(m,function(n,o){var p=$(o).find(".image-description").html();
b.push(p);});if(k==1){a.mostrarImagenPrincipal();}a.insertarImagenesEnFormulario("#listaimagenes_content","#listadesc_content");a.editLeyenda();a.saveChangesBt2();
},start:function(o,q,p,n){var m=0;$("#path_logo_preview").bind("change",function(w){$(l).val($(this).val());w.preventDefault();var v=$("#path_logo_preview");
var t=(v.val().substr(v.val().length-4,v.val().length)).toUpperCase();var u=o.split("|");if(u[0].toUpperCase()==t||u[1].toUpperCase()==t||u[2].toUpperCase()==t||u[3].toUpperCase()==t){var s=1;
if($.browser.msie){s=1;}else{s=v[0].files[0].size;}if(s<=n){}else{}}else{$(f).addClass("bad").addClass("response").html(p);$(f).removeClass("loading");
}});$("#upload-data").bind("click",function(w){$(l).val($(this).val());w.preventDefault();$(f).removeClass("hide").removeClass("bad").removeClass("response").html("");
$(f).addClass("loading");var v=$("#path_logo_preview");var t=(v.val().substr(v.val().length-4,v.val().length)).toUpperCase();var u=o.split("|");if(u[0].toUpperCase()==t||u[1].toUpperCase()==t||u[2].toUpperCase()==t||u[3].toUpperCase()==t){var s=1;
if($.browser.msie){s=1;}else{s=v[0].files[0].size;}if(s<=n){a.subirFile(m,v,n,q);}else{$(f).addClass("bad").addClass("response").html(q);$(f).removeClass("loading");
}}else{$(f).addClass("bad").addClass("response").html(p);$(f).removeClass("loading");}});a.carga();a.btnCerrar();a.dragAndDrop();a.establecerImagenPrincipal();
a.establecerPrincipal();},subirFile:function(m,q,n,s){var p=$('<form style="display:none;"></form>');var o=$("<iframe name='frmdescarga"+m+"' src='javascript:false;'></iframe>");
o.bind("load",function(){o.unbind("load").bind("load",function(){a.timeReadIframe(o,200,0,function(x){if($.trim(x[0])!="success"){$(f).addClass("bad").addClass("response").html(s).removeClass("loading");
}else{i.push(x[1]);b.push(x[2]);a.mostrarImagen("#contentImgs",x,function(){a.mostrarImagenPrincipal();});p.remove();$(f).removeClass("loading");$("#txtImageDescription").val("");
$("#path_logo_preview").val("");q="";}});});var u=q;var w=u.clone(true);q.after(w);p.append(u);var t=$("<input type='hidden' name='filesize' value='"+n+"' />"),v=$("<input type='hidden' name='input-desc' value='"+$("#txtImageDescription").val()+"' />");
p.append(t);p.append(v);p.attr("target",o.attr("name"));p.attr("action",urls.siteUrl+"/gestor/beneficios/cargafoto2");p.attr("method","POST");p.attr("enctype","multipart/form-data");
p.attr("encoding","multipart/form-data");p.submit();w.replaceWith(q);});p.append(o).appendTo("body");},timeReadIframe:function(n,o,m,p){setTimeout(function(){var s=undefined;
if($.browser.msie&&$.browser.version.substr(0,1)<8){s=window.frames[n.attr("name")].document.body.innerHTML;}else{s=$(n)[0].contentDocument.body.innerHTML;
}var q=s.split("|");if(m>3){p.call(this,q);}else{if($.trim(q[0])!="success"){a.timeReadIframe(n,o,m+1,p);}else{p.call(this,q);}}},o);},mostrarImagenes:function(m){$(m).html("");
$.each(i,function(p,q){var o="<img style='width:125px; height:70px;' valor='"+q+"' src='"+urls.siteUrl+"/"+q+"' class='imgPrev' />";var n="<li class='aGesImgLittle'> "+o+" <div class='admiGeCrossLittle iTooltip'><span class='tip hide'>Eliminar Imagen</span>  </div><div id='admi-edit'><a href='#edit-picture' class='winModal'>&nbsp;</a></div><div id='admi-star'></div><div class='image-description'>"+b[p]+"</div></li>";
$(m).append(n);});a.insertarImagenesEnFormulario("#listaimagenes_content","#listadesc_content");},mostrarImagen:function(p,o,q){var n="<img style='width:125px; height:70px;' valor='"+o[1]+"' src='"+urls.siteUrl+"/"+o[1]+"' class='imgPrev hide' />";
var m="<li class='aGesImgLittle'> "+n+" <div class='admiGeCrossLittle iTooltip'><span class='tip hide'>Eliminar Imagen</span>  </div><div id='admi-edit'><a href='#edit-picture' class='winModal'>&nbsp;</a></div><div id='admi-star'></div><div class='image-description'>"+o[2]+"</div></li>";
$(p).append(m);$(".imgPrev:last").fadeIn("slow",function(){$(this).removeClass("hide");});q.call(this);a.insertarImagenesEnFormulario("#listaimagenes_content","#listadesc_content");
},mostrarImagenPrincipal:function(){if(i.length==0){$(g).html("");$(h).html("");}else{var m="<img style='width:173px; height:97px;' src='"+urls.siteUrl+"/"+i[0]+"' class='imgPrev hide' />";
$(g).html(m);$(h).html(b[0]);if(i.length<2){$(g+" .imgPrev").fadeIn("slow",function(){$(this).removeClass("hide");});$(h+" .imgPrev").fadeIn("slow",function(){$(this).removeClass("hide");
});}else{$(g+" .imgPrev").removeClass("hide");$(h+" .imgPrev").removeClass("hide");}}},btnCerrar:function(){$(j).live("click",function(){var m=$(this).parent();
m.find(".imgPrev").fadeOut("fast",function(){var n=$(this).attr("valor");var o=a.indexOfArray(n);if(o!=-1){$.ajax({url:"/gestor/beneficios/eliminarfoto",type:"POST",dataType:"JSON",data:{img:n},success:function(){}});
delete i[o];delete b[o];a.updateArray();a.mostrarImagenPrincipal();m.html("");m.animate({width:"0px"},"fast",function(){m.remove();});a.insertarImagenesEnFormulario("#listaimagenes_content","#listadesc_content");
}else{$(this).fadeIn("fast",function(){alert("ERROR: No se pudo eliminar imagen");});}});});},indexOfArray:function(m){r=-1;$.each(i,function(n,o){if($.trim(o)==$.trim(m)){r=n;
}});return r;},indexOfArray2:function(m){r=-1;$.each(b,function(n,o){if($.trim(o)==$.trim(m)){r=n;}});return r;},updateArray:function(){var n=new Array();
var m=new Array();$.each(i,function(o,p){if(p!=undefined){n.push(p);}});$.each(b,function(o,p){if(p!=undefined){m.push(p);}});i=n;b=m;},dragAndDrop:function(){var m=$(".aGesImgLittle").find(".imgPrev");
m.live("mousedown",function(n){var o=$(this).parent();o.find(".imgPrev").css("cursor","move");o.parent().css("z-index","8");o.bind("mousemove",function(q){o.css("position","absolute");
o.css("z-index","5");var p=parseInt(q.pageX/1);var s=parseInt(q.pageY/1);o.css("left",p*1-$(this).width()/2-10+"px");o.css("top",s*1-$(this).height()/2-10+"px");
q.preventDefault();q.stopPropagation();});o.bind("mouseup",function(u){o.unbind("mousemove");o.unbind("mouseup");o.css("z-index","1");var w=parseInt((u.pageX-$("#galeria").position().left-70)/125);
var v=parseInt((u.pageY-$("#galeria").position().top-40)/70);if(w>=0&&v>=0){var t=v*3+w;if(t<i.length){var y=i[t];var q=b[t];var s=o.find(".imgPrev").attr("valor");
var x=o.find(".image-description").html();var p=a.indexOfArray(s);i[p]=y;b[p]=q;i[t]=s;b[t]=x;if(i.length>2){i[p]=i[1];b[p]=b[1];i[1]=y;b[1]=q;}a.mostrarImagenes("#contentImgs");
a.mostrarImagenPrincipal();}}o.removeAttr("style");});n.preventDefault();n.stopPropagation();});},establecerImagenPrincipal:function(){$("#admi-star").live("click",function(){var u=$(this);
var s=$(this).parent();var q=s.find(".imgPrev").attr("valor");var n=s.find(".image-description").html();if(i.length>0){var t=i[0];var p=b[0];var m=a.indexOfArray(q);
var o=a.indexOfArray2(n);i[0]=q;i[m]=t;b[0]=n;b[o]=p;if(i.length>2){i[m]=i[1];i[1]=t;b[o]=b[1];b[1]=p;}$("#FirstImagen").fadeOut("fast",function(){$(this).fadeIn("fast");
});$("#SecondImage").fadeOut("fast",function(){$(this).fadeIn("fast");});s.fadeOut("fast",function(){a.mostrarImagenes("#contentImgs");a.mostrarImagenPrincipal();
});}});},editLeyenda:function(){$("#admi-edit").live("click",function(){var q=$(this);var p=$(this).parent();var o=p.find(".imgPrev").attr("valor");var m=p.find(".image-description").html();
$("#edit-image-desc").val(m);$("#error_sinstructions").fadeOut("fast");if(i.length>0){var n=a.indexOfArray2(m);$("#edit-id-image").val(n);}});},saveChangesBt2:function(){$("#saveChangesBt2").live("click",function(){if($("#edit-image-desc").val()==""){b[$("#edit-id-image").val()]=" ";
}else{b[$("#edit-id-image").val()]=$("#edit-image-desc").val();}$("#idCloseChangeE").trigger("click");a.mostrarImagenes("#contentImgs");a.mostrarImagenPrincipal();
});},establecerPrincipal:function(){$(".aGesImgLittle").live("mouseover",function(){}).live("mouseleave",function(){});},insertarImagenesEnFormulario:function(p,o){var m="";
$.each(i,function(q,s){m=m+$.trim(s)+"|";});m=m.substring(0,m.length-1);$(p).html("<input type='hidden' value='"+m+"' name='listaimagenes' />");var n="";
$.each(b,function(s,q){n=n+$.trim(q)+"|";});n=n.substring(0,n.length-1);$(o).html("<input type='hidden' value='"+n+"' name='descimagenes' />");},insertarDescEnFormulario:function(m){}};
a.start(".jpg|.png|jpeg|.gif|wbmp","TamaÃ±o de archivo sobrepasa el limite Permitido.","Archivo debe tener extensiones .jpg, .png, .jpeg, .gif",524288);
});$(function(){$("#edit-image-desc").keyup(function(d){var i=$(this).val(),a=120,j=i.length,f=(a-j),c="#error_sinstructions",b="#me_sinstructions",l="Te quedan",h="caracteres disponibles",k="Has usado los",g="caracteres permitidos";
if(f>=0){f=a-j;$(c).fadeIn();$(b).html(" "+l+" "+f+" "+h+".");if(f<=0){$(c).fadeIn();$(b).html(" "+k+" "+a+" "+g+".");}}else{if(f<=0){$(c).fadeIn();$(b).html(" "+k+" "+a+" "+g+".");
}$(this).val(i.substring(0,a));}});$("#edit-image-desc").blur(function(b){var a="#error_sinstructions";$(a).fadeOut();});$("#txtImageDescription").keyup(function(d){var i=$(this).val(),a=120,j=i.length,f=(a-j),c="#error_sinstructions2",b="#me_sinstructions2",l="Te quedan",h="caracteres disponibles",k="Has usado los",g="caracteres permitidos";
if(f>=0){f=a-j;$(c).fadeIn();$(b).html(" "+l+" "+f+" "+h+".");if(f<=0){$(c).fadeIn();$(b).html(" "+k+" "+a+" "+g+".");}}else{if(f<=0){$(c).fadeIn();$(b).html(" "+k+" "+a+" "+g+".");
}$(this).val(i.substring(0,a));}});$("#txtImageDescription").blur(function(b){var a="#error_sinstructions2";$(a).fadeOut();});});